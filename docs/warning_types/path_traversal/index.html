
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Brakeman: Path Traversal</title>
    <meta name="description" content="Brakeman is a static analysis security vulnerability scanner for Ruby on Rails applications."/>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="/stylesheets/screen.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <meta name="og:title" content="Brakeman - Path Traversal" />
    <meta name="og:description" content="Brakeman Static Analysis Security Scanner for Ruby on Rails" />
    <meta name="og:image" content="https://brakemanscanner.org/images/brakeman_logo_dark.png" />
</head>
<body class="docs">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="/" class="logo">
                    <img src="/images/brakeman_logo_small.png" alt="Brakeman Logo">
                    Brakeman
                </a>
                <ul class="nav-links"><li>
                            <a href="/docs/" class="active">
                                Documentation
                            </a>
                        </li><li>
                            <a href="/blog/archives">
                                News
                            </a>
                        </li><li>
                            <a href="https://github.com/presidentbeef/brakeman">
                                Code
                            </a>
                        </li></ul>
                <div class="mobile-menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Documentation Container -->
<div class="docs-container">
    <div class="container">
        <div class="docs-layout">
            <!-- Sidebar -->
            <aside class="docs-sidebar">
                
                    <div class="sidebar-section">
                        <h3>Getting Started</h3>
                        <ul class="sidebar-links">
                            
                                <li>
                                    <a href="/docs/" 
                                       >
                                        Overview
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/quickstart/" 
                                       >
                                        Quickstart Guide
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/install/" 
                                       >
                                        Installation
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/running/" 
                                       >
                                        Basic Usage
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                
                    <div class="sidebar-section">
                        <h3>Configuration</h3>
                        <ul class="sidebar-links">
                            
                                <li>
                                    <a href="/docs/options/" 
                                       >
                                        Options
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/configuration/" 
                                       >
                                        Configuration Files
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/ignoring_false_positives/" 
                                       >
                                        Ignoring False Positives
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                
                    <div class="sidebar-section">
                        <h3>More Information</h3>
                        <ul class="sidebar-links">
                            
                                <li>
                                    <a href="/docs/warning_types/" 
                                       >
                                        Warning Types
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/confidence/" 
                                       >
                                        Confidence Levels
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/automation/" 
                                       >
                                        Automation
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/brakeman_as_a_library/" 
                                       >
                                        Brakeman as a Library
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                
                    <div class="sidebar-section">
                        <h3>Development</h3>
                        <ul class="sidebar-links">
                            
                                <li>
                                    <a href="/docs/contributing/" 
                                       >
                                        Contributing
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/testing_brakeman/" 
                                       >
                                        Test Structure
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="/docs/contributing/adding_tests/" 
                                       >
                                        Adding a Test
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                
            </aside>

            <!-- Main Content -->
            <main class="docs-content">
                <div class="docs-header">
                    <h1 class="docs-title">Path Traversal</h1>
                    
                </div>

                <div class="docs-body">
                    

                    <p>Path traversal vulnerabilities allow an attacker to access or manipulate files outside the intended
directory by providing specially crafted paths as input to read or write sensitive data. This can occur when 
improperly handling user-supplied input in filesystem-related operations such as image uploads, dynamic content loading, and user file downloads.</p>

<p>An attacker could exploit a path traversal vulnerability to:</p>

<ul>
  <li>Read sensitive files, including configuration files or other data containing credentials or encryption keys.</li>
  <li>Write files into restricted directories that enables code injection or privilege escalation.</li>
  <li>Download or delete critical system files.</li>
  <li>Gain access to user data and perform unauthorized actions.</li>
</ul>

<h2 id="example">Example</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># `params[:file][:path]` could contain "../../../../../etc/passwd", e.g.</span>

<span class="n">send_file</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'some'</span><span class="p">,</span> <span class="s1">'path'</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="ss">:file</span><span class="p">][</span><span class="ss">:path</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="pathname-confusion">Pathname Confusion</h2>

<p><code class="language-plaintext highlighter-rouge">Pathname#join</code> has some confusing behavior: <em>any</em> absolute path segment (e.g. starting with <code class="language-plaintext highlighter-rouge">/</code>) causes the path to be absolute from that point.</p>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; Pathname.new('a').join("a", "b", "/c", "d")
 =&gt; #&lt;Pathname:/c/d&gt; 
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">Rails.root</code> is a <code class="language-plaintext highlighter-rouge">Pathname</code>.</p>

<p>Exercise extreme caution when passing user-provided input to this function.</p>

<h3 id="additional-protections">Additional Protections</h3>

<p>Besides coding defensively, there are additional options for protecting against path traversal:</p>

<ul>
  <li>Use the ActiveStorage module for handling uploaded files and store them in a service like S3, rather than storing user data on the same server or directory as the application.</li>
  <li>Configure permissions on the application server to disallow writing files or reading files outside of the application directory.</li>
  <li>Never include user-provided values in the file path or the file name.</li>
</ul>

<p>A common pattern is to store files using application-generated file names, but keep a record of the user-provided name. When the user downloads the file, the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-download"><code class="language-plaintext highlighter-rouge">download</code></a> attribute and/or the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition">Content Disposition</a> header can be used to tell the browser the preferred name of the file, which can be the original user-provided name. Note that libraries like ActiveStorage will handle this for you.</p>

<p>However, be careful if users can download files named by <em>other</em> users. Overall, it is safer to generate file names from known-safe values.</p>

<hr />
<p>Back to <a href="/docs/warning_types">Warning Types</a></p>

                </div>
            </main>
        </div>
    </div>
</div>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content"><div class="footer-section">
                        <h4>Project</h4><a href="/docs/">Documentation</a><a href="https://github.com/presidentbeef/brakeman/releases">Changelog</a></div><div class="footer-section">
                        <h4>Community</h4><a href="https://github.com/presidentbeef/brakeman">GitHub</a><a href="https://github.com/presidentbeef/brakeman/discussions">Discussions</a><a href="https://github.com/presidentbeef/brakeman/issues">Issues</a><a href="/contributing/">Contributing</a></div><div class="footer-section">
                        <h4>Resources</h4><a href="/docs/quickstart/">Getting Started</a><a href="https://guides.rubyonrails.org/security.html">Rails Security Guide</a></div></div>
        </div>
    </footer>

    <script src="/javascripts/main.js"></script>
</body>
</html>
